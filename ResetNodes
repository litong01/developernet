# -*- mode: ruby -*-
# vi: set ft=ruby :

require 'yaml'

nodes = YAML.load_file("provisioning/nodes.conf.yml")
ids = YAML.load_file("provisioning/ids.conf.yml")


Vagrant.configure("2") do |config|
  config.vm.box = "tknerr/managed-server-dummy"
  config.vm.synced_folder "provisioning/guest", "/opt/guest"

  config.ssh.username = ids['username']
  config.ssh.password = ids['password']

  nodes.each do |key, value|
    config.vm.define "#{key}" do |node|
      node.vm.provider :managed do |managed|
        managed.server = nodes[key]['eth0']
      end

      node.vm.provision "reset", type: "shell" do |s|
        s.path = "provisioning/sys/reset_node.sh"
        s.args = nodes[key]['eth1']
      end

      node.vm.provision "install-common", type: "shell" do |s|
        s.path = "provisioning/sys/install_common.sh"
      end
    end
  end

end
